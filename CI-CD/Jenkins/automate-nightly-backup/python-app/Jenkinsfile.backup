pipeline{
    agent any

    environment {
        APP_DIR = "CI-CD/Jenkins/automate-nightly-backup/python-app/artifacts/"
    }

    stages{
        stage('Backup build to S3'){
            steps{
                dir(APP_DIR){
                    withCredentials([[$class: 'AmazonWebServicesCredentialsBinding', credentialsId: 'aws-creds']]) {
                        sh '''#!/bin/bash
                            LATEST_BUILD=$(ls -t *.tar.gz | head -1)
                            
                            aws s3 cp $LATEST_BUILD s3://python-app-nightly-backup/python-project/
                        '''
                    }
                }
            }
        }
    }
}